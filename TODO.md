# 功能开发清单

## ✅ 已完成功能

- [x] 实时监控 `~/.claude/history.jsonl`
- [x] 历史记录浏览（按会话分组）
- [x] AI 总结功能
- [x] AI 对话助手
- [x] 配置管理
- [x] 图片提取和显示
- [x] 导出功能
- [x] 自动清理缓存
- [x] 常用命令管理
- [x] 完整对话查看

---

## 🆕 待开发功能

### Phase 1: 核心数据增强（高优先级）⭐⭐⭐⭐⭐

#### 1.1 Token 统计和成本计算

- [x] 提取每条消息的 token 使用量（input_tokens, output_tokens）
- [x] 提取缓存 token（cache_creation_input_tokens, cache_read_input_tokens）
- [x] 计算 API 调用成本（USD）
- [x] 会话级别的 token 统计
- [x] 项目级别的 token 统计
- [x] 在会话卡片上显示 Token 徽章
- [x] 在会话卡片上显示成本徽章

#### 1.2 工具调用标记和统计

- [x] 标记会话是否包含工具调用（has_tool_use）
- [x] 标记会话是否有错误（has_errors）
- [x] 统计工具调用次数
- [x] 统计各类工具使用频率（Read、Write、Bash 等）
- [x] 在会话卡片上显示工具调用图标
- [x] 在会话卡片上显示错误图标

#### 1.3 消息类型识别

- [x] 识别消息类型（user、assistant、system、summary 等）
- [x] 识别子类型（hook、microcompaction-boundary 等）
- [x] 在完整对话弹窗中区分显示不同类型

---

### Phase 2: 统计和分析（高优先级）⭐⭐⭐⭐

#### 2.1 全局统计面板

- [x] 创建 Statistics 页面
- [x] 显示总 token 使用量
- [x] 显示总成本
- [x] 显示总会话数
- [x] 显示最常用的工具
- [x] 使用趋势图表（折线图、柱状图）

#### 2.2 项目级别统计

- [x] 每个项目的总 token 使用量
- [x] 每个项目的总成本
- [x] 每个项目的会话数量
- [x] 每个项目的工具使用情况
- [ ] 项目对比功能

#### 2.3 工具使用统计

- [x] 统计每个工具的使用次数
- [ ] 统计每个工具的成功率
- [ ] 统计每个工具的平均耗时
- [x] 工具使用排行榜

---

### Phase 3: 文件编辑历史（高优先级）⭐⭐⭐⭐

#### 3.1 文件修改追踪

- [x] 解析 `file-history-snapshot` 消息
- [x] 记录每次对话修改的文件列表
- [x] 保存文件快照内容
- [x] 在完整对话弹窗中显示文件修改列表

#### 3.2 Recent Edits 页面

- [x] 创建独立的 "Recent Edits" 页面
- [x] 按时间倒序显示所有文件修改
- [x] 按文件路径过滤
- [x] 按项目过滤
- [x] 显示文件修改前后对比
- [x] 文件还原功能（从快照恢复）
- [ ] 快速跳转到相关会话

---

### Phase 4: 会话对比和可视化（中优先级）⭐⭐⭐

#### 4.1 会话对比功能

- [ ] 选择多个会话进行对比
- [ ] 对比 token 使用量
- [ ] 对比工具调用情况
- [ ] 对比消息数量和时长
- [ ] 对比成本
- [ ] 并排显示对比结果

#### 4.2 Session Board（会话看板）

- [ ] 创建 Session Board 页面
- [ ] 多会话像素视图
- [ ] 属性刷选（按 token、成本、工具调用等）
- [ ] 交互式对比分析

#### 4.3 工具调用流程图

- [ ] 可视化工具调用顺序
- [ ] 显示工具调用的输入输出
- [ ] 显示工具调用的耗时
- [ ] 显示工具调用的成功/失败状态

---

### Phase 5: 性能优化（低优先级）⭐⭐

#### 5.1 实时文件监控优化

- [ ] 优化 `fs.watch` 性能
- [ ] 添加更细粒度的变化检测
- [ ] 减少不必要的文件读取
- [ ] 添加文件变化去抖动

#### 5.2 大数据量优化

- [ ] 虚拟滚动（大量会话时）
- [ ] 分页加载优化
- [ ] 数据缓存策略
- [ ] 懒加载图片和文件快照

---

## 📊 优先级说明

- ⭐⭐⭐⭐⭐ 最高优先级（立即实现）
- ⭐⭐⭐⭐ 高优先级（近期实现）
- ⭐⭐⭐ 中优先级（后续实现）
- ⭐⭐ 低优先级（长期规划）

---

## 🎯 快速开始

### 立即开始：Phase 1.1 Token 统计

1. 创建 Token 统计相关的数据模型
2. 实现 Token 提取和成本计算逻辑
3. 创建 UI 徽章组件
4. 在会话卡片上显示统计信息

---

**版本**: v2.0
**日期**: 2026-02-09
**状态**: 待实施
